<!DOCTYPE html>
<html>
<head>
    <!-- This title is not used. -->
    <title>Targeted Activity</title> 
    
    <!-- Use Bootstrap to match the look of OU Campus. -->
    <link rel="stylesheet" href="lib/bootstrap.min.css">
	<link rel="stylesheet" href="http://a.cms.omniupdate.com/resources/icomoon/style.css">
    
    <style type="text/css">
        body {
            margin: 10px;
            background-color: transparent;
        }
		
		ul {
			list-style-type: none;
			padding: 0;
			margin: 0;
		}
		
		.activity li {
			border-top: 1px solid #D8DFEA;
			padding: 2px 10px;
			line-height: 20px;
		}
		
		.activity .icon {
			font-size: 16px;
			float: left;
			margin-right: 6px;
		}
    </style>
    
    <script type="text/javascript" src="lib/jquery-2.1.3.min.js"></script>
    <script type="text/javascript" src="lib/gadgetlib.js"></script>
    
    <script type="text/javascript">
        
        $(document).ready(function () {
			var api_host = '',
			token = '',
			account = '',
			gid = '',
			auth = '',
			site = '',
			user = '',
			count;
			
			gadget.ready().then(function () {
				api_host = gadget.get('apihost');
				token = gadget.get('token');
				account = gadget.get('account');
				gid = gadget.get('gid');
				auth = {
					authorization_token: token,
					account: account,
					gadget: gid
				};
				site = gadget.get('site');
				user = gadget.get('user');
				count = 25;
				
				$.ajax({
					type: 'GET',
					url: api_host + '/activity/list' + '?site=' + site + '&count=' + count, 
					data: auth, 
					success: function (data) {
						console.log(data);
						
						$(data).each(function() {
							var activityItem = $(
							'<li>' + 
								'<div class="icon"><i class="icon-broadcast-2"></i></div>' + 
								'<div class="activity">' + 
									'<div class="subject">' + 
										'<a class="filename" href="/10/#outc16/workshop14/outc16/browse/staging/workshop-hackathon/targeted-activity" title="' + this['resource_name'] + '" target="_top">' + this['resource_name'] + '</a>' + 
									'</div>' + 
									'<div class="what">' + 
										this['resource'].toLowerCase() + ' published by ' + this['username'] + 
									'</div>' + 
									'<div class="when">' + 
										this['date_format'] + 
									'</div>' +
								'</div>' +
							'</li>');
							$('#activity-list').append(activityItem);
						});
					},
					error: function (xhr, status, error) {
						console.error('Error:', status, error);
					}
				});
			});
			
        });
        
        $(gadget).on({
            'expanded': function (evt) {
                // This event is triggered when the user expands (makes visible) a sidebar gadget.
                console.log('Gadget expanded.');
            },
            'collapsed': function (evt) {
                // This event is triggered when the user collapses (hides) a sidebar gadget.
                console.log('Gadget collapsed.');
            },
            'configuration': function (evt, config) {
                // If the user changes the gadget's configuration through the configuration modal,
                // the gadget will hear about it and get the new config in the data argument here.
                console.log('New config:', config);
                $('#main').css({ 'font-size': config.font_size });
            },
            'notification': function (evt, notification) {
                // If the gadget's config.xml contains a "notification" entry, any notifications
                // of the specified type(s) generated by OU Campus will trigger 'notification'
                // events that can be handled here.
                console.log('Notification received:', notification);
            }
        });
        
    </script>
</head>
<body>
    <div id="main">
        <ul id="activity-list">
			<!-- Activity Items Added Here -->
		</ul>
    </div>
    <div style="display:none">
        <!-- ouc:ob --><!-- /ouc:ob -->
    </div>
</body>
</html>
